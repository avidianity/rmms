{"version":3,"sources":["Styles/auth.module.css","assets/center.jpg","Components/Auth/Login.tsx"],"names":["module","exports","Login","props","useState","processing","setProcessing","attempts","setAttempts","state","get","color","setColor","useForm","resolver","yupResolver","yup","shape","email","required","password","register","handleSubmit","errors","history","useHistory","submit","payload","a","authExpires","date","dayjs","Date","isAfter","remove","toastr","info","axios","post","data","user","token","set","success","name","push","routes","DASHBOARD","add","toJSON","setTimeout","handleError","useEffect","key","listen","unlisten","has","className","data-mode","style","backgroundImage","bg","backgroundSize","backgroundRepeat","styles","card","src","alt","icon","onSubmit","ref","type","id","outIf","disabled","message"],"mappings":"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","file":"static/js/18.f48e798a.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"card\":\"auth_card__2Fqm8\",\"icon\":\"auth_icon__1YXzV\"};","export default __webpack_public_path__ + \"static/media/center.aad078aa.jpg\";","import React, { FC, useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useHistory } from 'react-router-dom';\nimport { routes } from '../../routes';\nimport styles from '../../Styles/auth.module.css';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport * as yup from 'yup';\nimport axios from 'axios';\nimport { User } from '../../Contracts/User';\nimport toastr from 'toastr';\nimport state from '../../state';\nimport { handleError, outIf } from '../../helpers';\nimport bg from '../../assets/center.jpg';\nimport dayjs from 'dayjs';\n\ntype Props = {};\n\nconst Login: FC<Props> = (props) => {\n\tconst [processing, setProcessing] = useState(false);\n\tconst [attempts, setAttempts] = useState(0);\n\tconst [color, setColor] = useState(state.get<string>('background-color') || 'dark');\n\tconst { register, handleSubmit, errors } = useForm({\n\t\tresolver: yupResolver(\n\t\t\tyup.object().shape({\n\t\t\t\temail: yup.string().required('Email Address is required.').email(),\n\t\t\t\tpassword: yup.string().required('Password is required.'),\n\t\t\t})\n\t\t),\n\t});\n\tconst history = useHistory();\n\n\tconst submit = async (payload: any) => {\n\t\tsetProcessing(true);\n\t\tconst authExpires = state.get('auth-expires');\n\t\tif (authExpires) {\n\t\t\tconst date = dayjs(authExpires);\n\t\t\tif (dayjs(new Date()).isAfter(date)) {\n\t\t\t\tstate.remove('auth-expires');\n\t\t\t} else {\n\t\t\t\treturn toastr.info(`Authentication temporarily disabled. Please try again after a few minutes.`);\n\t\t\t}\n\t\t}\n\t\ttry {\n\t\t\tconst {\n\t\t\t\tdata: { user, token },\n\t\t\t} = await axios.post<{ user: User; token: string }>('/auth/login', payload);\n\t\t\tstate.set('user', user);\n\t\t\tstate.set('token', token);\n\t\t\ttoastr.success(`Welcome back, ${user.name}!`);\n\t\t\thistory.push(routes.DASHBOARD);\n\t\t} catch (error) {\n\t\t\tsetAttempts(attempts + 1);\n\t\t\tif (attempts >= 3 || attempts + 1 >= 3) {\n\t\t\t\tstate.set('auth-expires', dayjs(new Date()).add(2, 'minutes').toJSON());\n\t\t\t\tsetTimeout(() => state.remove('auth-expires'), 1000 * 60 * 2);\n\t\t\t}\n\t\t\thandleError(error);\n\t\t} finally {\n\t\t\tsetProcessing(false);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconst key = state.listen<string>('background-color', (color) => setColor(color));\n\t\treturn () => {\n\t\t\tstate.unlisten('background-color', key);\n\t\t};\n\t}, []);\n\n\tif (state.has('user')) {\n\t\thistory.push(routes.DASHBOARD);\n\t\treturn null;\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tclassName='d-flex h-100vh align-items-center justify-content-center wrapper'\n\t\t\tdata-mode={color}\n\t\t\tstyle={{\n\t\t\t\tbackgroundImage: `url(${bg})`,\n\t\t\t\tbackgroundSize: 'cover',\n\t\t\t\tbackgroundRepeat: 'no-repeat',\n\t\t\t}}>\n\t\t\t<div className={`card ${styles.card}`}>\n\t\t\t\t<div className='card-header text-center'>\n\t\t\t\t\t<img src='/assets/img/manifest-icon-512.png' alt='' className={`rounded-circle shadow border ${styles.icon} my-2`} />\n\t\t\t\t\t<h4 className='card-title mt-1'>Records Monitoring and Management System</h4>\n\t\t\t\t\t<h5 className='card-title'>MCHG</h5>\n\t\t\t\t</div>\n\t\t\t\t<form onSubmit={handleSubmit(submit)}>\n\t\t\t\t\t<div className='card-body'>\n\t\t\t\t\t\t<div className='form-group bmd-form-group'>\n\t\t\t\t\t\t\t<label className='bmd-label-floating'>Email Address</label>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tref={register}\n\t\t\t\t\t\t\t\ttype='email'\n\t\t\t\t\t\t\t\tname='email'\n\t\t\t\t\t\t\t\tid='email'\n\t\t\t\t\t\t\t\tclassName={`form-control ${outIf(errors.email, 'is-invalid')}`}\n\t\t\t\t\t\t\t\tdisabled={processing}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{errors.email ? <div className='invalid-feedback'>{errors.email.message}</div> : null}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className='form-group bmd-form-group'>\n\t\t\t\t\t\t\t<label className='bmd-label-floating'>Password</label>\n\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\tref={register}\n\t\t\t\t\t\t\t\ttype='password'\n\t\t\t\t\t\t\t\tname='password'\n\t\t\t\t\t\t\t\tid='password'\n\t\t\t\t\t\t\t\tclassName={`form-control ${outIf(errors.password, 'is-invalid')}`}\n\t\t\t\t\t\t\t\tdisabled={processing}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t{errors.password ? <div className='invalid-feedback'>{errors.password.message}</div> : null}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className='form-group '>\n\t\t\t\t\t\t\t<button type='submit' className='btn btn-success btn-sm w-100' disabled={processing}>\n\t\t\t\t\t\t\t\t{processing ? <i className='material-icons spin'>refresh</i> : 'Login'}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div className='d-flex'>\n\t\t\t\t\t\t\t{/* <Link to={routes.REGISTER} className='btn btn-link btn-success p-0'>\n\t\t\t\t\t\t\t\tDon't have an account? Register\n\t\t\t\t\t\t\t</Link> */}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n\nexport default Login;\n"],"sourceRoot":""}